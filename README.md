R Basics for Lecture 1
================

## Econ B2000, Statistics and Introduction to Econometrics

## Kevin R Foster, Colin Powell School, the City College of New York, CUNY

For this class we’ll be using the statistical analysis program, R. The
computer labs here on campus have the necessary software. If you have
your own computer, download and install the program from [R
Project](http://www.r-project.org/) along with
[R-Studio](http://www.rstudio.com/). Depending on your particular device
these details will be different so take it patiently and figure it out -
there are sufficient online sources for help, to address any problem
that arises.

The best way to learn it is to just do it. How many times have you got a
new game, skipped reading the instructions, and learned by crashing it a
few times? This isn’t quite so simple but the basic gist remains - try
it. Below I give you some pointers about how to just do it, but they’re
meant to be read then immediately done in real life, I’ll give you some
commands to just copy-and-paste into the program.

The program, R, is the machine underneath that does the work, while
R-Studio is a skin on top that makes it easier to use. Install both then
run R-Studio, and you’ll get something that looks like this: ![image of
R Studio](screenshot_RStudio1.png)

The screen has 4 parts: the Console at lower left (where I drew the
green arrow) is most important since that’s where you type in the
commands to R.

You can start by just copying and pasting commands from this document
into the “Console” and seeing the output from the program.

The guide, *An Introduction to R*, suggests these commands to give a
basic flavor of what’s done and hint at the power. Don’t worry too much
about each step for now, this is just a glimpse to show that with a few
commands you can do some relatively sophisticated estimation – i.e. for
a small cost you can get a large benefit. Copy them and paste into the
“Console”.

``` r
x <- 1:50
w <- 1 + sqrt(x)/2
example1 <- data.frame(x=x, y= x + rnorm(x)*w)
attach(example1)
```

This creates x and y variables (where the rnorm command creates random
numbers from a normal distribution), puts them into a data frame, then
attaches that data frame so that R can use it in later calculations.
(What’s a data frame? A way to collect together related data items.)
Next some stats - create a linear model (that’s the “lm”) then a
“lowess” nonparametric local regression, and plot the two estimations to
compare. (Just copy and paste these, don’t worry about understanding
them for now!)

``` r
fm <- lm(y ~ x)
summary(fm)
```

    ## 
    ## Call:
    ## lm(formula = y ~ x)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -8.7849 -1.8484 -0.4217  1.7703  8.4669 
    ## 
    ## Coefficients:
    ##             Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)  0.73747    1.00745   0.732    0.468    
    ## x            0.99021    0.03438  28.799   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 3.509 on 48 degrees of freedom
    ## Multiple R-squared:  0.9453, Adjusted R-squared:  0.9442 
    ## F-statistic: 829.4 on 1 and 48 DF,  p-value: < 2.2e-16

``` r
lrf <- lowess(x, y)
plot(x, y)
lines(x, lrf$y)
abline(0, 1, lty=3)
abline(coef(fm))
```

![](R_lecture1_householdpulse_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

``` r
detach()
```

Your own graph should look similar although with the random numbers, not
exactly.

The final “detach” command just cleans up, it is the opposite of
“attach”.

Later you will find that while it is possible to go back and fix up code
that you previously ran in R (the up arrow brings most recent commands),
it is a bit of a pain. It is easier to write out the code in the
upper-left panel, then R-Studio can obediently run all or part of it in
R for you (as you hit Ctrl-Enter, it runs each line). Then if you make a
mistake or just want to do it again, it’s a bit easier. You can save
your code for next time, as well.

One big thing to learn is that while pushing buttons is easier at first,
eventually you want to be able to write code. I won’t insist that you do
that from day \#1, but keep it in mind as a goal to work towards. In R,
you can usually see the code generated by the button-pushes so you can
learn.

For all of these commands, you can use the help box on R Studio. But as
I said, don’t worry much about those commands for now, I’m not expecting
you to become an R-ninja overnight.

# With Some Data

We will go through some basic stats with R using the Census Bureau’s
Household Pulse Data, a survey about how people were doing in Covid
times. I will help you get some quick wins before circling back to get
into more detail.

You have to learn a bit about your computer’s filing system. When you
download stuff it probably goes into a Download folder. When you
installed R and R-Studio, those went into their own folders (probably
within some Application folder) and then the program might have created
a R folder for your work.

It’s now time to be intentional and organized. Create a folder for your
R work. Within that folder, create a separate folder for each project
that you work on – so for this project, create a folder called
“ecob2000_lecture1”.

Go and download the Household Pulse data from the [class
page](http://kfoster.ccny.cuny.edu/classes/fall2023/), which will likely
put that zip file into your Downloads folder. Within that zip file is
one particular file, Household_Pulse_data_w57.RData - move that into
your new folder, ecob2000_lecture1.

Note that you can’t just download the zip file and run the program, you
have to extract the particular .RData file – that regularly trips up
people as they begin.

R will look for files in a particular directory or folder (same concept
just different words). Type the command, “getwd()” to see where it’s
currently looking. Then use the command, “setwd,” to tell it where it
ought to be looking (the R/ecob2000_lecture1 folder that you created
just now, or wherever you put that data file). Alt you can click
“Session” then “Set Working Directory” then “Choose Directory” and click
the folder, and that will insert the “setwd” command onto the Console
line. Tell R to look for the data in the folder where you put the data.
Even better is to use R Studio’s Project function [here’s more
detail](https://www.r-bloggers.com/rstudio-projects-and-working-directories-a-beginners-guide/).

Then run these commands (output from those commands is below),

``` r
load("Household_Pulse_data_w57.RData")
#glimpse(acs2017_ny) try this later
Household_Pulse_data[1:10,1:6]
```

    ##       RHISPANIC RRACE      EEDUC       MS EGENID_BIRTH GENID_DESCRIBE
    ## 1  Not Hispanic White  some coll divorced         male           male
    ## 2  Not Hispanic White  some coll  married         male           male
    ## 3  Not Hispanic White    adv deg  widowed       female         female
    ## 4      Hispanic White  assoc deg  married       female         female
    ## 5  Not Hispanic White    adv deg  married         male           male
    ## 6  Not Hispanic White  some coll    never         male    transgender
    ## 7  Not Hispanic White HS diploma divorced         male           male
    ## 8  Not Hispanic Black  some coll    never         male           male
    ## 9  Not Hispanic Black   bach deg divorced         male           male
    ## 10 Not Hispanic White    adv deg  married       female         female

``` r
attach(Household_Pulse_data)
```

The data is structured that each row is a person, so first person is
somebody who’s not Hispanic, is white, has some college but no degree,
is divorced, was born as male and currently identifies as male and then
there is a lot more data in the other variables. Next row, row two,
again much the same answers but is married; row three is a widowed
female with an advanced degree, etc. ; then on for many more rows.

You can also use the command, summary, to find out about data.

``` r
summary(Household_Pulse_data)
```

    ##         RHISPANIC       RRACE                EEDUC               MS       
    ##  Not Hispanic:53858   White:48490   less than hs:  435   NA       :  410  
    ##  Hispanic    : 5432   Black: 4814   some hs     :  911   married  :33462  
    ##                       Asian: 2963   HS diploma  : 7583   widowed  : 3217  
    ##                       Other: 3023   some coll   :12638   divorced : 9080  
    ##                                     assoc deg   : 6118   separated: 1020  
    ##                                     bach deg    :16668   never    :12101  
    ##                                     adv deg     :14937                    
    ##  EGENID_BIRTH       GENID_DESCRIBE       SEXUAL_ORIENTATION
    ##  male  :25369   NA         :  665   NA            :  831   
    ##  female:33921   male       :24720   gay or lesbian: 1982   
    ##                 female     :33048   straight      :52232   
    ##                 transgender:  246   bisexual      : 2439   
    ##                 other      :  611   something else: 1038   
    ##                                     dont know     :  768   
    ##                                                            
    ##                       KIDS_LT5Y                         KIDS_5_11Y   
    ##  NA                        :52617   NA                       :50004  
    ##  Yes children under 5 in HH: 6673   Yes children 5 - 11 in HH: 9286  
    ##                                                                      
    ##                                                                      
    ##                                                                      
    ##                                                                      
    ##                                                                      
    ##                      KIDS_12_17Y                                 ENROLLNONE   
    ##  NA                        :49978   NA                                :54743  
    ##  Yes children 12 - 17 in HH: 9312   children not in any type of school: 4547  
    ##                                                                               
    ##                                                                               
    ##                                                                               
    ##                                                                               
    ##                                                                               
    ##                RECVDVACC    
    ##  NA                 :  657  
    ##  yes got vaxx       :51003  
    ##  no did not get vaxx: 7630  
    ##                             
    ##                             
    ##                             
    ##                             
    ##                                      KIDGETVAC_LT5Y 
    ##  NA                                         :54740  
    ##  kids under 5yo definitely get vaxx         :  396  
    ##  kids under 5yo probably get vaxx           :  395  
    ##  unsure kids under 5yo get vaxx             :  576  
    ##  kids under 5yo probably NOT get vaxx       :  785  
    ##  kids under 5yo definitely NOT get vaxx     : 1867  
    ##  do not know plans for vaxx for kids under 5:  531  
    ##                                    KIDGETVAC_5_11Y 
    ##  NA                                        :55023  
    ##  kids 5-11yo definitely get vaxx           :   85  
    ##  kids 5-11yo probably get vaxx             :  188  
    ##  unsure kids 5-11 get vaxx                 :  394  
    ##  kids 5-11yo probably NOT get vaxx         :  800  
    ##  kids 5-11yo definitely NOT get vaxx       : 2353  
    ##  do not know plans for vaxx for kids 5-11yo:  447  
    ##                                     KIDGETVAC_12_17Y
    ##  NA                                         :56458  
    ##  kids 12-17yo definitely get vaxx           :   27  
    ##  kids 12-17yo probably get vaxx             :   76  
    ##  unsure kids 12-17yo get vaxx               :  174  
    ##  kids 12-17yo probably NOT get vaxx         :  425  
    ##  kids 12-17yo definitely NOT get vaxx       : 1809  
    ##  do not know plans for vaxx for kids 12-17yo:  321  
    ##                               HADCOVIDRV   
    ##  NA                                : 1102  
    ##  yes tested + or doc told had Covid:32598  
    ##  no                                :25590  
    ##                                            
    ##                                            
    ##                                            
    ##                                            
    ##                                LONGCOVID    
    ##  NA                                 :27018  
    ##  had symptoms 3mo or more Long Covid: 8607  
    ##  no                                 :23665  
    ##                                             
    ##                                             
    ##                                             
    ##                                             
    ##                                     SYMPTOMS                      WRKLOSSRV    
    ##  NA                                     :26909   NA                    : 1548  
    ##  had no covid symptoms although tested +: 1558   yes recent HH job loss: 4740  
    ##  had mild Covid symptoms                :13524   no recent HH job loss :53002  
    ##  had moderate Covid symptoms            :13723                                 
    ##  had severe Covid symptoms              : 3576                                 
    ##                                                                                
    ##                                                                                
    ##                           ANYWORK                     KINDWORK    
    ##  NA                           : 1700   NA                 :23250  
    ##  yes employment in last 7 days:36608   work for govt      : 6140  
    ##  no employment in last 7 days :20982   work for private co:20145  
    ##                                        work for nonprofit : 4778  
    ##                                        self employed      : 4245  
    ##                                        work in family biz :  732  
    ##                                                                   
    ##             RSNNOWRKRV           SETTING     
    ##  NA              :39253   NA         :23287  
    ##  retired         :11890   Healthcare : 6018  
    ##  other           : 2603   other      : 4535  
    ##  sick or disabled: 2112   Educ       : 4400  
    ##  caring for kids :  887   Profess Svc: 2851  
    ##  did not want    :  852   IT         : 2360  
    ##  (Other)         : 1693   (Other)    :15839  
    ##                                 TWDAYS     
    ##  NA                                : 4055  
    ##  had 1-2 telework days in past week: 5541  
    ##  had 3-4 telework days in past week: 3907  
    ##  had 5+ telework days in past week : 9478  
    ##  had no telework days in past week :36309  
    ##                                            
    ##                                            
    ##                           CURFOODSUF   
    ##  NA                            : 4935  
    ##  had enough food               :34622  
    ##  had enough but not what wanted:15574  
    ##  sometimes not enough food     : 3148  
    ##  often not enough food         : 1011  
    ##                                        
    ##                                        
    ##                                                CHILDFOOD    
    ##  NA                                                 :52309  
    ##  often kids not eating enough because couldnt afford:  371  
    ##  sometimes kids not eating enough                   : 1346  
    ##  kids got enough food                               : 5264  
    ##                                                             
    ##                                                             
    ##                                                             
    ##                                             ANXIOUS     
    ##  NA                                             : 7480  
    ##  no anxiety over past 2 wks                     :21934  
    ##  several days anxiety over past 2 wks           :17679  
    ##  more than half the days anxiety over past 2 wks: 5371  
    ##  nearly every day anxiety                       : 6826  
    ##                                                         
    ##                                                         
    ##                                              WORRY      
    ##  NA                                             : 7623  
    ##  no worry over past 2 wks                       :27405  
    ##  several days worried over past 2 wks           :14891  
    ##  more than half the days worried over past 2 wks: 4419  
    ##  nearly every day worry                         : 4952  
    ##                                                         
    ##                                                         
    ##                             PRICESTRESS   
    ##  NA                               : 9760  
    ##  very stressed about price changes:19609  
    ##  Moderate stress price changes    :15131  
    ##  a little stress price changes    :11530  
    ##  no stress                        : 3260  
    ##                                           
    ##                                           
    ##                            TENURE     
    ##  NA                           : 9164  
    ##  housing owned free and clear :13055  
    ##  housing owned with mortgage  :24455  
    ##  housing rented               :11946  
    ##  housing occupied without rent:  670  
    ##                                       
    ##                                       
    ##                                 LIVQTRRV                RENTCUR     
    ##  live in detached 1 family          :34610   NA             :47467  
    ##  NA                                 : 9503   current on rent:10734  
    ##  live in bldg w 5+ apts             : 6336   behind on rent : 1089  
    ##  live in 1 family attached to others: 3845                          
    ##  live in mobile home                : 1906                          
    ##  live in building with 3-4 apts     : 1655                          
    ##  (Other)                            : 1435                          
    ##                 MORTCUR                                             EVICT      
    ##  NA                 :34907   NA                                        :58235  
    ##  current on mortgage:23470   very likely evicted in next 2 months      :  142  
    ##  behind on mortgage :  913   somewhat likely evicted in next 2 months  :  245  
    ##                              not very likely evicted in next 2 months  :  316  
    ##                              not at all likely evicted in next 2 months:  352  
    ##                                                                                
    ##                                                                                
    ##                                        FORCLOSE            EST_ST     
    ##  NA                                        :58396   California: 4066  
    ##  very likely forclosed in next 2 months    :   34   Texas     : 2841  
    ##  somewhat likely forclosed in next 2 months:  150   Washington: 2323  
    ##  not very likely forclosed in next 2 months:  307   Florida   : 1977  
    ##  not at all forclosed in next 2 months     :  403   Michigan  : 1661  
    ##                                                     Arizona   : 1600  
    ##                                                     (Other)   :44822  
    ##                    PRIVHLTH                      PUBHLTH            REGION     
    ##  has private health ins:40328   has public health ins:19999   Northeast: 8624  
    ##  no private health ins : 9773   no public health ins :28600   South    :19123  
    ##  NA                    : 9189   NA                   :10691   Midwest  :12824  
    ##                                                               West     :18719  
    ##                                                                                
    ##                                                                                
    ##                                                                                
    ##                    INCOME       TBIRTH_YEAR   Num_kids_Pub_School
    ##  NA                   :10833   Min.   :1935   Min.   :0.00       
    ##  HH income $100k - 149: 9131   1st Qu.:1958   1st Qu.:1.00       
    ##  HH income $50k - 74.9: 7959   Median :1971   Median :2.00       
    ##  HH income $75 - 99.9 : 6719   Mean   :1971   Mean   :1.72       
    ##  HH income $200k +    : 6184   3rd Qu.:1984   3rd Qu.:2.00       
    ##  HH income $35k - 49.9: 5147   Max.   :2005   Max.   :4.00       
    ##  (Other)              :13317                  NA's   :47219      
    ##  Num_kids_Priv_School Num_kids_homeschool Amout_spent_on_food  Monthly_Rent  
    ##  Min.   :0.0          Min.   :0.00        Min.   :  0.0       Min.   :   0   
    ##  1st Qu.:1.0          1st Qu.:0.00        1st Qu.:125.0       1st Qu.: 850   
    ##  Median :1.0          Median :1.00        Median :200.0       Median :1300   
    ##  Mean   :1.2          Mean   :1.05        Mean   :236.9       Mean   :1450   
    ##  3rd Qu.:2.0          3rd Qu.:2.00        3rd Qu.:300.0       3rd Qu.:1900   
    ##  Max.   :2.0          Max.   :2.00        Max.   :900.0       Max.   :3500   
    ##  NA's   :57333        NA's   :58281       NA's   :8478        NA's   :48016

So this shows that there are 59,290 people in this dataset.

### Simple Stats

We compare the average birth year of the men and the women in the data,

``` r
summary(TBIRTH_YEAR[GENID_DESCRIBE == "female"])
```

    ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    ##    1935    1959    1971    1971    1984    2005

``` r
summary(TBIRTH_YEAR[GENID_DESCRIBE == "male"])
```

    ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    ##    1935    1957    1970    1970    1984    2005

``` r
summary(TBIRTH_YEAR[GENID_DESCRIBE == "transgender"])
```

    ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    ##    1935    1984    1992    1989    1998    2005

``` r
summary(TBIRTH_YEAR[GENID_DESCRIBE == "other"])
```

    ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    ##    1935    1964    1980    1977    1992    2005

``` r
summary(TBIRTH_YEAR[GENID_DESCRIBE == "NA"])
```

    ##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    ##    1935    1952    1962    1964    1975    2005

This uses the factor variable, GENID_DESCRIBE, which asks people about
their current gender identity.

Males in this dataset are, on average, a bit older, with an average age
of 52.8 compared with 51.5 for females. You might wonder (if you were to
begin to think like a statistician) whether that is a big difference -
hold onto that thought!

Alternately you can use the commands to calculate the average, mean(),
and the standard deviation, sd(), to get those statistics:

``` r
# here i want to find average ages of men and women
mean(TBIRTH_YEAR[GENID_DESCRIBE == "female"])
```

    ## [1] 1971.481

``` r
sd(TBIRTH_YEAR[GENID_DESCRIBE == "female"])
```

    ## [1] 15.61139

``` r
mean(TBIRTH_YEAR[GENID_DESCRIBE == "male"])
```

    ## [1] 1970.25

``` r
sd(TBIRTH_YEAR[GENID_DESCRIBE == "male"])
```

    ## [1] 16.17685

Later you might encounter cases where you want more complicated dummy
variables and want to use logical relations “and” “or” “not” (the
symbols “&”, “\|”, “!”) or the “\>=” or multiplication or division.

As you’re going along, if you’re copying-and-pasting then you might not
have had trouble, but if you’re typing then you’ve probably realized
that R is persnickety - the variable TBIRTH_YEAR is not equivalent to
tbirth_year nor TBirthYear nor tBirTH_YeaR… You might be wondering if
there’s an easier way than copy-paste; *there is*. If you highlight text
in the Source pane and then hit CTRL-Enter, that will run the block of
code. Alt if you click the “Knit HTML” button from the Rmd file then
that will recreate the webpage as well as run all of the commands.

### More Details

At the beginning you’ll be just copying commands that I give you but as
you start making changes, you have to understand what’s going on.

For better or worse there is rarely just a single way of doing things,
when people talk about the R language it does indeed have many features
of a language. Just like a spoken language has many ways of saying “hi”
so too there are lots of different ways to ask R to produce means of
different groups. I am showing you a few particular ways but if you look
around online you’ll find others.

Remember to save your work. The computers in the lab wipe the memory
clean when you log off so back up your files. GitHub is the best way to
do that – especially since you’ll be collaborating on work.

But be careful - you have the option of saving your code and/or your
workspace; it is always better to save just the code. For example, your
code might load some data (at this stage, usually data that I’ve
provided). If you make changes to this data during your session, you do
not want to restart with those changes. If you just save your code and
re-run the program, you will start fresh. If instead you save the
workspace, then you end up saving all of your scraps and changes - which
eventually start to build up. So only save your workspace if you’ve run
a large chunk of code that you don’t want to have to later re-run. (This
is even more true if you “attach” data frames without later “detach”-ing
them!)

This is a whole different approach to workflow and project management.
The old bad way is to have something like an Excel sheet, where a human
goes through and makes a few changes to the original data – and these
changes might well be smart and good! But they don’t replicate and
they’re even tough to remember after some time. And it’s tough to track
back and find errors, whether they are typos or were in the original
data.

There are 2 main file types: R script (lines of instructions to R on how
to calculate some statistics) and R Markdown (which combines the
instructions to R along with text around it, which is how I created this
file). There are more types of course but those are the ones for now.

There is a bigger philosophy behind this: the idea of “reproducible
research,” that if you share your .Rmd file then anybody else can run
the exact same program and get the exact same results. It’s a way of
convincing an audience that there was no skulduggery in how the data
relates to the conclusion. It’s useful in class since it’s an easy way
to submit homework or share work with your study group.

Sharing is caring. You’ve got to get in the habit of knowing that your
code is not some personal scratch file that only has to work for you.
Most workplaces are in teams so the code has to be understandable more
broadly. And if you recall from Behavioral Economics, there are times
where it’s useful to think of your future self as a different person. (I
do that! I load old code that I wrote and sometimes yell, “I hate the
frickin a-hole who wrote this code!”) So set good habits right from the
beginning. If you have your own desk in your own office then maybe it’s
a mess, that’s your choice. But if you share a space then you know you
have to be neater and not be that slob that everybody else hates. Your
coding too. You will share code with your study group.

You will put your code on GitHub – that’s how you will work with your
study group and how you’ll submit homework. If you decide to work in the
field, you will want to share examples of your code and GitHub is the
standard.

Create an account on GitHub – first [here’s Jenny Bryan with a great
explanation of the
why](https://dx.doi.org/10.7287%2Fpeerj.preprints.3159v2), then [she
gives complete instructions here](https://happygitwithr.com/index.html).
Go read the first about why, then read her parts 4 and 5 and create your
account. You’ll eventually read the whole thing carefully.

Each set of coding should be a Project – in RStudio, that’s a particular
thing. In File menu, find “New Project”. Each project has its own folder
along with subfolders within for data and output. Above I asked you to
create a R folder with subfolders within for each project including
ecob2000_lecture1 for this one.

In your code, use the comments generously. I sometimes first use the
comments to write what I’m trying to do as a way to set down my goals
for each segment. Then can implement them with the following code.
Again, be mindful that other people (and your future self) will be
trying to follow along with your code to understand what’s going on.

In the next part (Lecture 1 A) I’ll go a bit deeper into the coding,
talk about packages in R, and get into some details about the PUMS data.
